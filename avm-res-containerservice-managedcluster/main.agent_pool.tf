module "nodepools" {
  source   = "./modules/agentpool"
  for_each = var.agent_pools

  name                          = each.value.name
  parent_id                     = azapi_resource.this.id
  availability_zones            = each.value.availability_zones
  capacity_reservation_group_id = each.value.capacity_reservation_group_id
  count_of                      = each.value.count_of
  create_before_destroy         = var.create_agentpools_before_destroy
  creation_data                 = each.value.creation_data
  enable_auto_scaling           = each.value.enable_auto_scaling
  enable_encryption_at_host     = each.value.enable_encryption_at_host
  enable_fips                   = each.value.enable_fips
  enable_node_public_ip         = each.value.enable_node_public_ip
  enable_ultra_ssd              = each.value.enable_ultra_ssd
  gateway_profile               = each.value.gateway_profile
  gpu_instance_profile          = each.value.gpu_instance_profile
  gpu_profile                   = each.value.gpu_profile
  host_group_id                 = each.value.host_group_id
  kubelet_config                = each.value.kubelet_config
  kubelet_disk_type             = each.value.kubelet_disk_type
  linux_os_config               = each.value.linux_os_config
  local_dns_profile             = each.value.local_dns_profile
  max_count                     = each.value.max_count
  max_pods                      = each.value.max_pods
  message_of_the_day            = each.value.message_of_the_day
  min_count                     = each.value.min_count
  mode                          = each.value.mode
  network_profile               = each.value.network_profile
  node_labels                   = each.value.node_labels
  node_public_ip_prefix_id      = each.value.node_public_ip_prefix_id
  node_taints                   = each.value.node_taints
  orchestrator_version          = each.value.orchestrator_version
  os_disk_size_gb               = each.value.os_disk_size_gb
  os_disk_type                  = each.value.os_disk_type
  os_sku                        = each.value.os_sku
  os_type                       = each.value.os_type
  output_data_only              = each.value.output_data_only
  pod_ip_allocation_mode        = each.value.pod_ip_allocation_mode
  pod_subnet_id                 = each.value.pod_subnet_id
  proximity_placement_group_id  = each.value.proximity_placement_group_id
  scale_down_mode               = each.value.scale_down_mode
  scale_set_eviction_policy     = each.value.scale_set_eviction_policy
  scale_set_priority            = each.value.scale_set_priority
  security_profile              = each.value.security_profile
  spot_max_price                = each.value.spot_max_price
  tags                          = each.value.tags
  timeouts                      = var.agentpool_timeouts
  type                          = each.value.type
  upgrade_settings              = each.value.upgrade_settings
  virtual_machines_profile      = each.value.virtual_machines_profile
  vm_size                       = each.value.vm_size
  vnet_subnet_id                = each.value.vnet_subnet_id
  windows_profile               = each.value.windows_profile
  workload_runtime              = each.value.workload_runtime
}
